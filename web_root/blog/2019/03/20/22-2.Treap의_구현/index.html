<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css"><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><title> | Luke's Note</title><link href="/css/app.4121a211.css" rel="preload" as="style"><link href="/css/chunk-vendors.bad0137f.css" rel="preload" as="style"><link href="/js/app.904ac315.js" rel="preload" as="script"><link href="/js/chunk-vendors.319ec894.js" rel="preload" as="script"><link href="/css/chunk-vendors.bad0137f.css" rel="stylesheet"><link href="/css/app.4121a211.css" rel="stylesheet"><meta charset="utf-8" data-vue-meta="true"><meta property="og:image" content="https://wbluke.com/img/about.f9a09115.jpeg" data-vmid="og:image" data-vue-meta="true"><meta property="og:title" content="22-2.Treapì˜_êµ¬í˜„ | Luke's Note" data-vmid="og:title" data-vue-meta="true"><meta property="og:description" content="Thank you for reading my article ğŸ¦Š" data-vmid="og:description" data-vue-meta="true"><script type="text/javascript" async="">var disqus_shortname  = "wbluke-com";
var disqus_title      = "22-2.Treapì˜_êµ¬í˜„";
var disqus_identifier = "/2019/03/20/22-2.Treapì˜_êµ¬í˜„/";
var disqus_url        = "http://wbluke.com/blog/2019/03/20/22-2.Treapì˜_êµ¬í˜„/";
</script><script type="text/javascript" async="" src="//wbluke-com.disqus.com/embed.js"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.9974049bf7b0591e5d4f055cb67f3ee3.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.880980e048a2432334f13013030456ac.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.7ca5005d1897180d07d928e89d2628be.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"></head><body><noscript></noscript><div id="app"><div id="site-title"><a href="/" class="page_title router-link-active"><h1><img id="site-logo" src="/img/favicon.4eb5b8a7.png" width="24" height="24">
        Luke's Note
      </h1></a></div><div class="menu effect"><ul><li><a href="/" class="router-link-active">About</a></li><li><a href="/blog/" class="router-link-active">Blog</a></li><li><a href="/insight/" class="">Insight</a></li></ul></div><p><div data-v-14d57e6a="" id="blog"><div data-v-14d57e6a="" id="blog-contents"><article data-v-14d57e6a=""><div data-v-14d57e6a="" class="inner-title-container"><h1 data-v-14d57e6a=""><a data-v-14d57e6a="" href="http://wbluke.com/blog/2019/03/20/22-2.Treapì˜_êµ¬í˜„/" id="inner-title">[ì•Œê³ ë¦¬ì¦˜] 22-2. Treapì„ ì§ì ‘ êµ¬í˜„í•˜ê¸°</a></h1><p data-v-14d57e6a="" class="meta">2019. 03. 20. </p></div><div data-v-14d57e6a="" id="article-content"><h1 id="ì•Œê³ ë¦¬ì¦˜-22-2.-treapì„-ì§ì ‘-êµ¬í˜„í•˜ê¸°" style="display: none;">[ì•Œê³ ë¦¬ì¦˜] 22-2. Treapì„ ì§ì ‘ êµ¬í˜„í•˜ê¸°</h1>
<h3 id="treap">Treap?</h3>
<hr>
<p>ë‹¤ìŒ ì•Œê³ ë¦¬ì¦˜ ì•„í‹°í´ì˜ ë¬¸ì œì¸ INSERTIONì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ Treapì´ë¼ëŠ” ìë£Œêµ¬ì¡°ì˜ ì§ì ‘ êµ¬í˜„ì´ í•„ìš”í•©ë‹ˆë‹¤. Treapì€ Treeì™€ Heapì˜ í•©ì„±ì–´ì¸ë°, Treapì´ ê²°êµ­ Treeì´ê¸°ë„ í•˜ê³  Heapì´ê¸°ë„ í•˜ê¸° ë•Œë¬¸ì— ë¶™ì—¬ì§„ ì´ë¦„ì…ë‹ˆë‹¤.</p>
<p>ì´ë¯¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì„±ëŠ¥ ì¢‹ì€ íŠ¸ë¦¬ê°€ êµ¬í˜„ë˜ì–´ ìˆëŠ”ë°, ì™œ ì´ëŸ° ìë£Œêµ¬ì¡°ë¥¼ êµ¬í˜„í•´ì•¼ í• ê¹Œìš”? í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì´ì§„ ê²€ìƒ‰ íŠ¸ë¦¬ëŠ” ëŒ€ë¶€ë¶„ Xë³´ë‹¤ ì‘ì€ ì›ì†Œì˜ ìˆ˜ë¥¼ ê³„ì‚°í•˜ê±°ë‚˜ kë²ˆì§¸ ì›ì†Œë¥¼ ì°¾ëŠ” ì—°ì‚°ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ëŸ° ì—°ì‚°ì´ ê¼­ í•„ìš”í•  ê²½ìš°ì—ëŠ” ì§ì ‘ BSTë¥¼ êµ¬í˜„í•  ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë‹¨ìˆœí•œ BSTì˜ ê²½ìš°, ë…¸ë“œê°€ í•œ ìª½ìœ¼ë¡œ ì ë¦´ ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì´ ìˆì–´ íŠ¹ì • í˜•íƒœì˜ ì…ë ¥ì— ëŒ€í•´ ì—°ê²°ë¦¬ìŠ¤íŠ¸ì²˜ëŸ¼ ë˜ì–´ë²„ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì–´ëŠ ì •ë„ ê· í˜• ì¡íŒ BSTë¥¼ êµ¬í˜„í•´ì•¼ë§Œ í•©ë‹ˆë‹¤. ì´ëŸ´ ë•Œ ë‹¤ì†Œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” BSTê°€ ë°”ë¡œ íŠ¸ë¦½ì…ë‹ˆë‹¤.</p>
<p>íŠ¸ë¦½ì€ ê· í˜•ì¡íŒ íŠ¸ë¦¬ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ ê° ë…¸ë“œì— ìš°ì„ ìˆœìœ„ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤. ì´ëŠ” Heapì˜ íŠ¹ì„±ì´ê¸°ë„ í•œë°ìš”, íŠ¸ë¦½ì—ì„œëŠ” ì´ ìš°ì„ ìˆœìœ„ë¥¼ ëœë¤ê°’ìœ¼ë¡œ ë¶€ì—¬í•©ë‹ˆë‹¤. ëœë¤ìœ¼ë¡œ ìš°ì„ ìˆœìœ„ê°€ ê²°ì •ë˜ê¸° ë•Œë¬¸ì— ì´ íŠ¸ë¦¬ ë†’ì´ì˜ ê¸°ëŒ€ì¹˜ëŠ” í•­ìƒ ì¼ì •í•©ë‹ˆë‹¤. ì•„ì£¼ ìš´ì´ ë‚˜ì˜ê²Œ ê· í˜•ì´ ì•ˆì¡í ìˆ˜ë„ ìˆì§€ë§Œ ê·¸ í™•ë¥ ì€ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤.</p>
<p>íŠ¸ë¦½ì˜ íŠ¹ì„±ì„ ë‹¤ì‹œ ì •ë¦¬í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<pre class="markdown"><code class="hljs"><span class="hljs-bullet">- </span>BSTì˜ ì¡°ê±´ : 
<span class="hljs-code">    ëª¨ë“  ë…¸ë“œì— ëŒ€í•´ ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ì— ìˆëŠ” ë…¸ë“œë“¤ì˜ ì›ì†ŒëŠ” í•´ë‹¹ ë…¸ë“œì˜ ì›ì†Œë³´ë‹¤ ì‘ê³ , </span>
<span class="hljs-code">    ì˜¤ë¥¸ìª½ ì„œë¸ŒíŠ¸ë¦¬ì— ìˆëŠ” ë…¸ë“œë“¤ì˜ ì›ì†ŒëŠ” í•´ë‹¹ ë…¸ë“œì˜ ì›ì†Œë³´ë‹¤ í¬ë‹¤.   </span>
<span class="hljs-bullet">- </span>Heapì˜ ì¡°ê±´ : 
<span class="hljs-code">    ëª¨ë“  ë…¸ë“œì˜ ìš°ì„ ìˆœìœ„ëŠ” ê°ìì˜ ìì‹ ë…¸ë“œë³´ë‹¤ í¬ê±°ë‚˜ ê°™ë‹¤.  </span></code></pre>
<h3 id="treap-êµ¬í˜„í•˜ê¸°">Treap êµ¬í˜„í•˜ê¸°</h3>
<hr>
<h4 id="treapnode">TreapNode</h4>
<p>ë¨¼ì € íŠ¸ë¦½ì˜ ë…¸ë“œë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TreapNode</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> key;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> priority;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> size;
    <span class="hljs-keyword">private</span> TreapNode left, right;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TreapNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span> </span>{
        <span class="hljs-keyword">this</span>.key = key;
        priority = Math.random();
        size = <span class="hljs-number">1</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLeft</span><span class="hljs-params">(TreapNode newNode)</span> </span>{
        left = newNode;
        calcSize();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRight</span><span class="hljs-params">(TreapNode newNode)</span> </span>{
        right = newNode;
        calcSize();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calcSize</span><span class="hljs-params">()</span> </span>{
        size = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (left != <span class="hljs-keyword">null</span>) size += left.size;
        <span class="hljs-keyword">if</span> (right != <span class="hljs-keyword">null</span>) size += right.size;
    }
}</code></pre>
<p>ë…¸ë“œì—ì„œ ì£¼ëª©í•  ê²ƒì€ key ì´ì™¸ì—ë„ ìš°ì„ ìˆœìœ„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” priorityê°€ ì¡´ì¬í•˜ë©°, í•´ë‹¹ ë…¸ë“œë¥¼ rootë¡œ í•œ ìì† ë…¸ë“œë“¤ì˜ ê°œìˆ˜ì¸ sizeë¥¼ ë“¤ê³  ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì´ sizeë¥¼ ëª¨ë“  ë…¸ë“œê°€ ê°ì ê°–ê³  ìˆìœ¼ë©´, ìš°ë¦¬ê°€ í•„ìš”í•œ ì—°ì‚°ì¸ Xë³´ë‹¤ ì‘ì€ ì›ì†Œì˜ ìˆ˜ë¥¼ ê³„ì‚°í•˜ê±°ë‚˜ kë²ˆì§¸ ì›ì†Œë¥¼ ì°¾ëŠ” ì—°ì‚°ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. sizeì˜ ì¡°ì •ì€ ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ë‚˜ ì˜¤ë¥¸ìª½ ì„œë¸ŒíŠ¸ë¦¬ê°€ ê°±ì‹ ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.</p>
<h4 id="ë…¸ë“œì˜-ì¶”ê°€ì™€-ìª¼ê°œê¸°-ì—°ì‚°">ë…¸ë“œì˜ ì¶”ê°€ì™€ ìª¼ê°œê¸° ì—°ì‚°</h4>
<p>ì´ì œ ì£¼ì–´ì§„ root íŠ¸ë¦½ì— ìƒˆ ë…¸ë“œì¸ nodeë¥¼ ì¶”ê°€í•˜ëŠ” ì—°ì‚°ì„ êµ¬í˜„í•´ ë´…ì‹œë‹¤. ë¨¼ì € rootì™€ nodeì˜ ìš°ì„ ìˆœìœ„ë¥¼ ë¹„êµí•©ë‹ˆë‹¤. ë§Œì•½ rootê°€ nodeë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤ë©´ nodeëŠ” rootì˜ ì•„ë˜ë¡œ ë“¤ì–´ê°€ë©´ ë˜ê² ì§€ìš”. ì™¼ìª½ìœ¼ë¡œ ê°ˆì§€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê°ˆì§€ëŠ” ê° ì„œë¸ŒíŠ¸ë¦¬ì™€ì˜ keyê°’ì„ ë¹„êµí•´ ê²°ì •í•˜ë©´ ë©ë‹ˆë‹¤.</p>
<p>ë¬¸ì œëŠ” rootë³´ë‹¤ nodeì˜ ìš°ì„ ìˆœìœ„ê°€ í´ ê²½ìš°ì…ë‹ˆë‹¤. ì´ ë•ŒëŠ” nodeê°€ rootë¥¼ ë°€ì–´ë‚´ê³  ìƒˆë¡œìš´ rootê°€ ë˜ë©°, ê¸°ì¡´ rootì˜ ìì†ë“¤ì€ ëª¨ë‘ nodeì˜ ìì†ë“¤ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¸°ì¡´ íŠ¸ë¦¬ë¥¼ nodeì˜ keyë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‘˜ë¡œ ë‚˜ëˆ ì•¼ í•˜ëŠ”ë°, ì´ë¥¼ êµ¬í˜„í•œ ë©”ì†Œë“œê°€ ë°”ë¡œ split()ì…ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pair</span>&lt;<span class="hljs-title">L</span>, <span class="hljs-title">R</span>&gt; </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> L left;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> R right;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Pair</span><span class="hljs-params">(L left, R right)</span> </span>{
        <span class="hljs-keyword">this</span>.left = left;
        <span class="hljs-keyword">this</span>.right = right;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> L <span class="hljs-title">getLeft</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> left;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">getRight</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> right;
    }
}

<span class="hljs-comment">// split root tree to two subTrees by key</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Pair&lt;TreapNode, TreapNode&gt; <span class="hljs-title">split</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> key)</span> </span>{
    <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pair(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);

    <span class="hljs-comment">// split right subTree if root is less than key</span>
    <span class="hljs-keyword">if</span> (root.key &lt; key) {
        Pair&lt;TreapNode, TreapNode&gt; rs = split(root.right, key);
        root.setRight(rs.getLeft());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pair(root, rs.getRight());
    }

    <span class="hljs-comment">// split left subTree if root is greater than or equal to key</span>
    Pair&lt;TreapNode, TreapNode&gt; rs = split(root.left, key);
    root.setLeft(rs.getRight());
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pair(rs.getLeft(), root);
}</code></pre>
<p>ìª¼ê°œì„œ ë‚˜ì˜¨ ë‘ ê°œì˜ íŠ¸ë¦½ì„ ë°˜í™˜ë°›ì•„ì•¼ í•˜ëŠ”ë°, ì œê°€ ì‚¬ìš©í•˜ëŠ” ì–¸ì–´ì¸ javaì—ì„œëŠ” ë§ˆë•…í•œ <code class="hljs">pair&lt;object, object&gt;</code> ê°€ ì—†ê¸° ë•Œë¬¸ì— ì„ì˜ë¡œ pair í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. cppì—ëŠ” pairê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p>
<p>rootì˜ keyê°€ nodeì˜ keyë³´ë‹¤ ì‘ì€ ê²½ìš°ì™€ í° ê²½ìš°ë¡œ ë‚˜ë‰ í…ë°, í•œ ìª½ë§Œ ìƒê°í•´ë³´ë©´ ë‹¤ë¥¸ ìª½ì€ ë°˜ëŒ€ë¡œ í•˜ë©´ ë˜ì–´ì„œ ë˜‘ê°™ìŠµë‹ˆë‹¤.<br>
ì‘ì€ ê²½ìš°ë¥¼ ìƒê°í•´ë´…ì‹œë‹¤. ê¸°ì¡´ rootì˜ ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ë“¤ì€ ëª¨ë‘ nodeì˜ keyë³´ë‹¤ ì‘ì€ ì›ì†Œë“¤ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ìš°ë¦¬ëŠ” rootì˜ ì˜¤ë¥¸ìª½ ì„œë¸ŒíŠ¸ë¦¬ë§Œ nodeì˜ key ê¸°ì¤€ìœ¼ë¡œ ìª¼ê°œì„œ ì¬êµ¬ì„±í•´ì£¼ë©´ ë©ë‹ˆë‹¤. (ê·¸ë¦¼ì„ ê·¸ë ¤ì„œ ì´í•´í•˜ë©´ ë§ë¡œ í•˜ëŠ” ê²ƒë³´ë‹¤ ì¡°ê¸ˆ ë” ì‰½ìŠµë‹ˆë‹¤.)</p>
<p>êµ¬í˜„í•œ split()ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆ ë…¸ë“œë¥¼ ì¶”ê°€í•˜ëŠ” insert()ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs"><span class="hljs-comment">// return root after inserting new node</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">insert</span><span class="hljs-params">(TreapNode root, TreapNode node)</span> </span>{
    <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> node;

    <span class="hljs-keyword">if</span> (root.priority &lt; node.priority) {
        Pair&lt;TreapNode, TreapNode&gt; splitted = split(root, node.key);
        node.setLeft(splitted.getLeft());
        node.setRight(splitted.getRight());
        <span class="hljs-keyword">return</span> node;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.key &lt; root.key) {
        root.setLeft(insert(root.left, node));
    } <span class="hljs-keyword">else</span> {
        root.setRight(insert(root.right, node));
    }
    <span class="hljs-keyword">return</span> root;
}</code></pre>
<h4 id="ë…¸ë“œì˜-ì‚­ì œì™€-í•©ì¹˜ê¸°-ì—°ì‚°">ë…¸ë“œì˜ ì‚­ì œì™€ í•©ì¹˜ê¸° ì—°ì‚°</h4>
<p>ë‘ íŠ¸ë¦¬ë¥¼ í•©ì¹˜ëŠ” merge()ì™€ ë…¸ë“œë¥¼ ì‚­ì œí•˜ëŠ” erase()ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs"><span class="hljs-comment">// merge two Treaps when max(a) &lt; min(b)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">merge</span><span class="hljs-params">(TreapNode a, TreapNode b)</span> </span>{
    <span class="hljs-keyword">if</span> (a == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> b;
    <span class="hljs-keyword">if</span> (b == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> a;
    <span class="hljs-keyword">if</span> (a.priority &lt; b.priority) {
        b.setLeft(merge(a, b.left));
        <span class="hljs-keyword">return</span> b;
    }
    a.setRight(merge(a.right, b));
    <span class="hljs-keyword">return</span> a;
}

<span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">erase</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> key)</span> </span>{
    <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> root;

    <span class="hljs-keyword">if</span> (root.key == key) {
        TreapNode ret = merge(root.left, root.right);
        root = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// will be erased by Garbage Collector later</span>
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-keyword">if</span> (key &lt; root.key) {
        root.setLeft(erase(root.left, key));
    } <span class="hljs-keyword">else</span> {
        root.setRight(erase(root.right, key));
    }
    <span class="hljs-keyword">return</span> root;
}</code></pre>
<p>merge()ì—ì„œëŠ” ë“¤ì–´ì˜¨ ë‘ íŠ¸ë¦¬ê°€ nullì¸ì§€ ë¨¼ì € í™•ì¸í•˜ê³  ì‹œì‘í•˜ê¸° ë•Œë¬¸ì—, ìì†ì´ í•œ ìª½ë§Œ ìˆëŠ” ê²½ìš° í˜¹ì€ ìì†ì´ ì—†ëŠ” ê²½ìš°ë¥¼ ëª¨ë‘ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. erase()ëŠ” íƒ€ê²Ÿ ë…¸ë“œë¥¼ ì œê±°í•œ í›„ ì œê±°ëœ ê¸°ì¡´ì˜ íŠ¸ë¦¬ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<h4 id="kë²ˆì§¸-ì›ì†Œ-ì°¾ê¸°">kë²ˆì§¸ ì›ì†Œ ì°¾ê¸°</h4>
<p>ê° ë…¸ë“œë§ˆë‹¤ ê°€ì§€ê³  ìˆëŠ” sizeë¥¼ ì´ìš©í•˜ì—¬ kë²ˆì§¸ ì›ì†Œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. rootë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê° ì„œë¸ŒíŠ¸ë¦¬ì˜ í¬ê¸°ë¥¼ ì•Œê³  ìˆìœ¼ë©´ kë²ˆì§¸ ë…¸ë“œê°€ ì–´ë”” ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ì˜ í¬ê¸°ë¥¼ lì´ë¼ í•˜ë©´, ë‹¤ìŒê³¼ ê°™ì´ ê²½ìš°ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆì§€ìš”.</p>
<pre class="markdown"><code class="hljs"><span class="hljs-bullet">- </span>k &lt;= l : kë²ˆì§¸ ë…¸ë“œëŠ” ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ì— ìˆìŠµë‹ˆë‹¤.
- k = l+1 : kë²ˆì§¸ ë…¸ë“œëŠ” rootì…ë‹ˆë‹¤.
- k &gt; l+1 : kë²ˆì§¸ ë…¸ë“œëŠ” ì˜¤ë¥¸ìª½ ì„œë¸ŒíŠ¸ë¦¬ì—ì„œ (k-l-1)ë²ˆì§¸ ë…¸ë“œê°€ ë©ë‹ˆë‹¤. </code></pre>
<p>ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ kth() ë©”ì†Œë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs"><span class="hljs-comment">// return kth node</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">kth</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> k)</span> </span>{
    <span class="hljs-keyword">int</span> leftSize = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (root.left != <span class="hljs-keyword">null</span>) leftSize = root.left.size;
    <span class="hljs-keyword">if</span> (k &lt;= leftSize) <span class="hljs-keyword">return</span> kth(root.left, k);
    <span class="hljs-keyword">if</span> (k == leftSize + <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> root;
    <span class="hljs-keyword">return</span> kth(root.right, k - leftSize - <span class="hljs-number">1</span>);
}</code></pre>
<h4 id="xë³´ë‹¤-ì‘ì€-ì›ì†Œ-ì„¸ê¸°">Xë³´ë‹¤ ì‘ì€ ì›ì†Œ ì„¸ê¸°</h4>
<p>ë˜ ë‹¤ë¥¸ ìœ ìš©í•œ ì—°ì‚°ìœ¼ë¡œ íŠ¹ì • ë²”ìœ„ [a, b)ê°€ ì£¼ì–´ì§ˆ ë•Œ ì´ ë²”ìœ„ ì•ˆì— ë“¤ì–´ê°€ëŠ” ì›ì†Œì˜ ìˆ«ìë¥¼ ê³„ì‚°í•˜ëŠ” ì—°ì‚°ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì£¼ì–´ì§„ ì›ì†Œ Xë³´ë‹¤ ì‘ì€ ì›ì†Œë“¤ì˜ ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” countLessThan()ì„ êµ¬í˜„í•˜ë©´ ê³„ì‚°í•´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. countLessThan(b) - countLessThan(a)ë¡œ ê³„ì‚°í•˜ë©´ ë˜ë‹ˆê¹Œìš”.<br>
ë¨¼ì € rootì˜ ì›ì†Œì™€ Xë¥¼ ë¹„êµí•©ë‹ˆë‹¤. ë§Œì•½ rootì˜ ì›ì†Œê°€ Xì™€ ê°™ê±°ë‚˜ ê·¸ë³´ë‹¤ í¬ë‹¤ë©´ rootì˜ ì˜¤ë¥¸ìª½ ì„œë¸ŒíŠ¸ë¦¬ì˜ ëª¨ë“  ì›ì†Œë“¤ì€ Xë³´ë‹¤ í° ì›ì†Œë“¤ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ì—ì„œ ì¬ê·€í˜¸ì¶œì„ í†µí•´ í•´ê²°í•´ì£¼ë©´ ë©ë‹ˆë‹¤.<br>
ë§Œì•½ ë°˜ëŒ€ë¡œ rootì˜ ì›ì†Œê°€ Xë³´ë‹¤ ì‘ë‹¤ë©´ rootì˜ ì™¼ìª½ ì„œë¸ŒíŠ¸ë¦¬ì˜ ì›ì†Œë“¤ì€ ëª¨ë‘ ë‹µì— ë“¤ì–´ê°€ê³ , ì˜¤ë¥¸ìª½ ì„œë¸ŒíŠ¸ë¦¬ì—ì„œ í•´ë‹¹í•˜ëŠ” ì›ì†Œë“¤ì„ ì¬ê·€ì ìœ¼ë¡œ ì„¸ì„œ ë‹µì— ë”í•´ì£¼ë©´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="java"><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">countLessThan</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> key)</span> </span>{
    <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (key &lt;= root.key) <span class="hljs-keyword">return</span> countLessThan(root.left, key);
    <span class="hljs-keyword">int</span> ls = (root.left != <span class="hljs-keyword">null</span> ? root.left.size : <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> ls + <span class="hljs-number">1</span> + countLessThan(root.right, key);
}</code></pre>
<h3 id="ì •ë¦¬">ì •ë¦¬</h3>
<hr>
<p>ì´ë ‡ê²Œ í•´ì„œ íŠ¹ì • ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œ êµ¬í˜„í•´ì•¼í•˜ëŠ” Treapì´ë¼ëŠ” ìë£Œêµ¬ì¡°ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ë‹¤ìŒ ì•„í‹°í´ì—ì„œ í•´ë‹¹ ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì•„ë˜ì— í•©ì¹œ ì†ŒìŠ¤ì½”ë“œë¥¼ ì²¨ë¶€í•©ë‹ˆë‹¤.</p>
<h3 id="ì½”ë“œ">ì½”ë“œ</h3>
<hr>
<details>
<p></p><summary>Treap í•œëˆˆì— ë³´ê¸°</summary><p></p>
<pre class="java"><code class="hljs"><span class="hljs-comment">/* Treap.java */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pair</span>&lt;<span class="hljs-title">L</span>, <span class="hljs-title">R</span>&gt; </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> L left;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> R right;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Pair</span><span class="hljs-params">(L left, R right)</span> </span>{
        <span class="hljs-keyword">this</span>.left = left;
        <span class="hljs-keyword">this</span>.right = right;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> L <span class="hljs-title">getLeft</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> left;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">getRight</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> right;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TreapNode</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> key;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> priority;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> size;
    <span class="hljs-keyword">private</span> TreapNode left, right;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TreapNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span> </span>{
        <span class="hljs-keyword">this</span>.key = key;
        priority = Math.random();
        size = <span class="hljs-number">1</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLeft</span><span class="hljs-params">(TreapNode newNode)</span> </span>{
        left = newNode;
        calcSize();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRight</span><span class="hljs-params">(TreapNode newNode)</span> </span>{
        right = newNode;
        calcSize();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calcSize</span><span class="hljs-params">()</span> </span>{
        size = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (left != <span class="hljs-keyword">null</span>) size += left.size;
        <span class="hljs-keyword">if</span> (right != <span class="hljs-keyword">null</span>) size += right.size;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Treap</span> </span>{

    <span class="hljs-comment">// split root tree to two subTrees by key</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Pair&lt;TreapNode, TreapNode&gt; <span class="hljs-title">split</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> key)</span> </span>{
        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pair(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);

        <span class="hljs-comment">// split right subTree if root is less than key</span>
        <span class="hljs-keyword">if</span> (root.key &lt; key) {
            Pair&lt;TreapNode, TreapNode&gt; rs = split(root.right, key);
            root.setRight(rs.getLeft());
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pair(root, rs.getRight());
        }

        <span class="hljs-comment">// split left subTree if root is greater than or equal to key</span>
        Pair&lt;TreapNode, TreapNode&gt; rs = split(root.left, key);
        root.setLeft(rs.getRight());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Pair(rs.getLeft(), root);
    }

    <span class="hljs-comment">// return root after inserting new node</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">insert</span><span class="hljs-params">(TreapNode root, TreapNode node)</span> </span>{
        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> node;

        <span class="hljs-keyword">if</span> (root.priority &lt; node.priority) {
            Pair&lt;TreapNode, TreapNode&gt; splitted = split(root, node.key);
            node.setLeft(splitted.getLeft());
            node.setRight(splitted.getRight());
            <span class="hljs-keyword">return</span> node;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.key &lt; root.key) {
            root.setLeft(insert(root.left, node));
        } <span class="hljs-keyword">else</span> {
            root.setRight(insert(root.right, node));
        }
        <span class="hljs-keyword">return</span> root;
    }

    <span class="hljs-comment">// merge two Treaps when max(a) &lt; min(b)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">merge</span><span class="hljs-params">(TreapNode a, TreapNode b)</span> </span>{
        <span class="hljs-keyword">if</span> (a == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> b;
        <span class="hljs-keyword">if</span> (b == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> a;
        <span class="hljs-keyword">if</span> (a.priority &lt; b.priority) {
            b.setLeft(merge(a, b.left));
            <span class="hljs-keyword">return</span> b;
        }
        a.setRight(merge(a.right, b));
        <span class="hljs-keyword">return</span> a;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">erase</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> key)</span> </span>{
        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> root;

        <span class="hljs-keyword">if</span> (root.key == key) {
            TreapNode ret = merge(root.left, root.right);
            root = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// will be erased by Garbage Collector later</span>
            <span class="hljs-keyword">return</span> ret;
        }
        <span class="hljs-keyword">if</span> (key &lt; root.key) {
            root.setLeft(erase(root.left, key));
        } <span class="hljs-keyword">else</span> {
            root.setRight(erase(root.right, key));
        }
        <span class="hljs-keyword">return</span> root;
    }

    <span class="hljs-comment">// return kth node</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TreapNode <span class="hljs-title">kth</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> k)</span> </span>{
        <span class="hljs-keyword">int</span> leftSize = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (root.left != <span class="hljs-keyword">null</span>) leftSize = root.left.size;
        <span class="hljs-keyword">if</span> (k &lt;= leftSize) <span class="hljs-keyword">return</span> kth(root.left, k);
        <span class="hljs-keyword">if</span> (k == leftSize + <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> root;
        <span class="hljs-keyword">return</span> kth(root.right, k - leftSize - <span class="hljs-number">1</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">countLessThan</span><span class="hljs-params">(TreapNode root, <span class="hljs-keyword">int</span> key)</span> </span>{
        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (key &lt;= root.key) <span class="hljs-keyword">return</span> countLessThan(root.left, key);
        <span class="hljs-keyword">int</span> ls = (root.left != <span class="hljs-keyword">null</span> ? root.left.size : <span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> ls + <span class="hljs-number">1</span> + countLessThan(root.right, key);
    }
}
</code></pre>
</details>
</div></article><hr data-v-14d57e6a=""><div data-v-14d57e6a="" id="disqus_thread"><iframe id="dsq-app4492" name="dsq-app4492" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="https://disqus.com/embed/comments/?base=default&amp;f=wbluke-com&amp;t_i=%2F2019%2F03%2F20%2F22-2.Treap%EC%9D%98_%EA%B5%AC%ED%98%84%2F&amp;t_u=http%3A%2F%2Fwbluke.com%2Fblog%2F2019%2F03%2F20%2F22-2.Treap%EC%9D%98_%EA%B5%AC%ED%98%84%2F&amp;t_e=22-2.Treap%EC%9D%98_%EA%B5%AC%ED%98%84&amp;t_d=%0A%20%20%20%20%20%20%20%20Luke's%20Note%0A%20%20%20%20%20%20&amp;t_t=22-2.Treap%EC%9D%98_%EA%B5%AC%ED%98%84&amp;s_o=default&amp;d_m=0#version=581fc4aed87cb2aed2487d2df585658d" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 0px !important;"></iframe></div></div></div></p></div><script src="/js/chunk-vendors.319ec894.js"></script><script src="/js/app.904ac315.js"></script><iframe style="display: none;"></iframe></body></html>